<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maze Game implementing BFS Algorithm | Henry Lam</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato:300" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K03ESX8LJE"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-K03ESX8LJE');
    </script>
    <style>
        /* Original styles - Reverted from theme system */
        body {
          font-family: 'Lato', sans-serif;
          font-weight: 300;
          font-size: 18px;
          color: #666;
          background-color: #f8f9fa;
          margin: 0;
          overflow-x: hidden;
            line-height: 1.8;
      }

      .custom-toggler.navbar-toggler {
            border-color: #ff9000; 
      }
      .navbar-brand h1 {
            font-family: 'Kaushan Script', cursive; 
          font-size: 26px;
          color: #ffffff;
          margin: 0;
      }
  
      .navbar-nav .nav-item .nav-link {
          font-family: 'Lato', sans-serif;
          color: #ffffff;
          font-size: 18px;
          align-items: center;
          display: flex;
          flex-direction: column;
          margin-bottom: 0;
      }
      
        h1, h2, h3, h4, h5, h6 {
          color: #3a170f;
          font-family: 'Lato', sans-serif;
            margin-bottom: 1rem;
        }
        h1 { font-size: 2.25em; line-height: 1.6; }
        h2 { font-size: 1.7em; line-height: 1.6; }
        h3 { font-size: 1.4em; line-height: 1.6; }
        p { color: #666; font-size: 18px; line-height: 1.8; }

        a {
            color: #ff9000;
            text-decoration: none !important;
        }
        a:hover {
            color: #e08000; /* Darker orange on hover */
            text-decoration: none !important;
        }
        .navbar-custom {
            background-color: #ff9000 !important;
        }
        .toggler-icon {
            background: #ffffff;
        }
        hr { border: none; height: 1px; background-color: #ff9000; margin: 30px 0; }

        .card, .feature-box, .method-card, .implementation-section, .results-container, .project-links, .nav-card, .suggested-project, .toc-nav {
            background-color: #fff;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        .feature-box h3, .method-icon, .result-number { color: #ff9000; }
        
        .toc-nav { padding: 20px; margin-bottom: 30px; }
        .toc-header { color: #3a170f; border-bottom: 2px solid #ff9000; font-weight: bold; font-size: 1.2em; padding-bottom: 10px; margin-bottom: 15px; }
        .toc-list { padding-left: 0; list-style: none;}
        .toc-list .nav-link { color: #666; padding: 8px 5px; border-left: 3px solid transparent; transition: all 0.3s ease;}
        .toc-list .nav-link:hover, .toc-list .nav-link.active {
            color: #ff9000;
            border-left-color: #ff9000;
            background-color: #f8f9fa;
        }

        .section-title { margin-top: 40px; padding-bottom: 10px; border-bottom: 3px solid #ff9000; display: inline-block;}
        .project-summary { font-size: 1.1em; line-height: 1.8; border-left: 4px solid #ff9000; padding-left: 15px; margin: 20px 0;}
        .image-caption { text-align: center; font-style: italic; color: #888; margin-top: 10px;}
        .lab-text { text-align: center; font-style: italic; color: #888;}

        img.result-pic, img.lab-gif, .project-img {
            border-radius: 10px;
            max-width: 100%;
            height: auto;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .project-img {
            width: 120px;
            height: 120px;
            border-radius: 6px;
            overflow: hidden;
            display: block;
            object-fit: cover;
    }
        
.suggested-project {
  margin-top: 5%;
  margin-bottom: 30px;
            background: transparent;
            border: none;
            box-shadow: none;
            max-width: 800px;
            margin-left: 0;
            margin-right: auto;
        }
        
.suggested-project:hover {
  transform: translateY(-5px);
  transition: .5s ease;
        }
        
        .project-details {
            text-align: left;
            padding-left: 15px;
        }
        
        .img-col {
            padding-right: 0 !important;
            display: flex;
            justify-content: flex-end;
        }
        
        .suggested-project .row.no-gutters {
            display: flex;
            align-items: center;
        }
        
        .suggested-project a {
            color: inherit;
            text-decoration: none;
  display: block;
        }
        
        .suggested-project h3 {
            margin-top: 0;
            margin-bottom: 8px;
            color: #3a170f;
            font-weight: normal;
        }
        
        .suggested-project p {
            margin-bottom: 0;
            color: #666;
            font-size: 16px;
        }

        /* Navigation section */
        .navigation-section { margin-top: 60px; margin-bottom: 40px; }
        .nav-card {
            background: transparent;
            box-shadow: none;
            border: none;
            display: block;
            padding: 15px 0;
            margin: 10px 0;
            color: #3a170f;
        }
        .nav-card:hover {
            color: #ff9000;
            transform: translateY(-5px);
            box-shadow: none;
            text-decoration: none;
        }
        .prev-card { text-align: left; }
        .next-card { text-align: right; }
        .nav-direction { font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; color: #888; }
        .nav-title { font-size: 1.2em; font-weight: bold; }

        .back-to-top { position: fixed; bottom: 30px; right: 30px; display: none; z-index: 99; }
        .back-to-top-btn { 
            width: 50px; 
            height: 50px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            box-shadow: 0 3px 10px rgba(0,0,0,0.2); 
            transition: all 0.3s ease;
  background-color: #ff9000;
            color: #ffffff;
        }
        .back-to-top-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            background-color: #e08000;
            color: #ffffff;
        }

        /* Main container spacing */
        .main-container {
            padding-top: 80px;
        }
        
        /* Responsive adjustments */
        @media (min-width: 992px) {
            .col-lg-9 {
                padding-top: 30px;
            }
        }
        
        @media (max-width: 991px) {
            .toc-nav {
                display: none;
            }
            .col-lg-9 {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }
        
        @media (max-width: 767px) {
            .main-container {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            .nav-card {
                text-align: center;
            }
            
            .project-img {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-sm navbar-custom navbar-light fixed-top" style="background-color: #ff9000;">
      <div class="container">
          <a class="navbar-brand" href="/"><h1>Henry Lam</h1></a>

          <!-- Toggle button for smaller devices -->
          <button class="navbar-toggler custom-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
              <span class="toggler-icon top-bar"></span>
              <span class="toggler-icon middle-bar"></span>
              <span class="toggler-icon bottom-bar"></span>
          </button>

          <!-- Navbar links -->
          <div class="collapse navbar-collapse" id="navbar">
              <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                      <a id="about-nav" class="nav-link theme2" href="https://henrylam.blog/#about">About Me</a>
                  </li>
                  <li class="nav-item">
                      <a id="resume-nav" class="nav-link theme2" href="https://henrylam.blog/#resume">Resume</a>
                  </li>
                  <li class="nav-item">
                      <a id="projects-nav" class="nav-link theme2" href="https://henrylam.blog/#projects">Projects</a>
                  </li>
              </ul>
          </div>
      </div>
  </nav>

    <!-- Content specific to the project -->
    <div class="main-container">
        <div class="row">
            <!-- Sticky Table of Contents -->
            <div class="col-lg-3 d-none d-lg-block">
                <nav id="toc" class="sticky-top toc-nav" style="top: 100px;">
                    <div class="toc-header">Contents</div>
                    <ul class="nav flex-column toc-list">
                        <li class="nav-item"><a class="nav-link" href="#intro">Introduction</a></li>
                        <li class="nav-item"><a class="nav-link" href="#bfs-algorithm">BFS Algorithm</a></li>
                        <li class="nav-item"><a class="nav-link" href="#game-design">Game Design</a></li>
                        <li class="nav-item"><a class="nav-link" href="#implementation">Implementation</a></li>
                        <li class="nav-item"><a class="nav-link" href="#features">Game Features</a></li>
                        <li class="nav-item"><a class="nav-link" href="#demo">Demo</a></li>
                        <li class="nav-item"><a class="nav-link" href="#conclusion">Conclusion</a></li>
                    </ul>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9">
                <div id="main-text" style="max-width: 850px; margin: 0 auto;">
                    <!-- Project content -->
                    <h1 id="intro" class="section-title">Maze Game implementing BFS Algorithm</h1>

                    <div class="project-summary">
                        <p>A Tom and Jerry themed maze game that uses the Breadth-First Search algorithm to find the shortest path through complex mazes, demonstrating pathfinding techniques in action.</p>
                    </div>

                    <div class="card feature-box">
                        <div class="card-body">
                            <p>This project combines algorithm implementation with game development, creating an engaging Tom and Jerry themed maze game. By implementing the Breadth-First Search (BFS) algorithm, the game demonstrates how computers can efficiently solve pathfinding problems while providing an entertaining user experience.</p>
                        </div>
                    </div>

                    <div class="project-image-container">
                        <img src="images/maze.png" alt="Tom and Jerry Maze Game" class="result-pic">
                        <div class="image-caption">Tom and Jerry Maze Game interface</div>
                    </div>

                    <h2 id="bfs-algorithm" class="section-title">BFS Algorithm</h2>
                    <div class="card feature-box">
                        <div class="card-body">
                            <p>Breadth-First Search is a graph traversal algorithm that starts at a selected node (in this case, Jerry's position) and explores all neighbor nodes at the present depth before moving on to nodes at the next depth level. In the context of a maze:</p>
                            <ol>
                                <li>The algorithm starts at Jerry's position</li>
                                <li>It explores all possible directions (up, down, left, right) from the current position</li>
                                <li>For each valid move (not a wall), it continues exploring from that position</li>
                                <li>The process continues until Tom (the target) is found or all paths are exhausted</li>
                                <li>The algorithm tracks the path taken, allowing it to determine the shortest route</li>
          </ol>
                        </div>
                    </div>

                    <div class="project-image-container">
                        <img src="images/short_path.png" alt="BFS Algorithm finding the shortest path" class="result-pic">
                        <div class="image-caption">BFS Algorithm finding the shortest path from Jerry to Tom</div>
                    </div>

                    <h2 id="game-design" class="section-title">Game Design</h2>
                    <p>The game features a Tom and Jerry theme, where Jerry (controlled by the player or AI) navigates through a maze to find Tom. The design incorporates:</p>
                    
                    <div class="results-container">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h3>Visuals</h3>
                                        <ul>
                                            <li>A grid-based maze layout</li>
                                            <li>Tom and Jerry character representations</li>
                                            <li>Visual indicators for walls and paths</li>
                                            <li>Path visualization showing the BFS solution</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h3>Gameplay</h3>
                                        <ul>
                                            <li>Manual player control mode</li>
                                            <li>AI mode demonstrating BFS pathfinding</li>
                                            <li>Multiple maze layouts with varying complexity</li>
                                            <li>Visual feedback for successful path finding</li>
        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 id="implementation" class="section-title">Implementation</h2>
                    <p>The implementation of the maze game and BFS algorithm involved several key components:</p>
                    
                    <div class="accordion mt-4" id="implementationAccordion">
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <h3 class="mb-0">
                                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        Maze Representation
                                    </button>
                                </h3>
                            </div>
                            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#implementationAccordion">
                                <div class="card-body">
                                    <p>The maze is represented as a 2D grid where each cell can be:</p>
                                    <ul>
                                        <li>A wall (impassable)</li>
                                        <li>An open path (passable)</li>
                                        <li>Jerry's position (start)</li>
                                        <li>Tom's position (goal)</li>
                                    </ul>
                                    <p>This structure allows for easy traversal during the BFS algorithm execution while maintaining a clear visual representation for the player.</p>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header" id="headingTwo">
                                <h3 class="mb-0">
                                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        BFS Algorithm Implementation
                                    </button>
                                </h3>
                            </div>
                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#implementationAccordion">
                                <div class="card-body">
                                    <p>The BFS algorithm was implemented with the following components:</p>
                                    <ul>
                                        <li>A queue data structure to manage nodes to be explored</li>
                                        <li>A visited set to track already explored positions</li>
                                        <li>A parent mapping to reconstruct the path</li>
                                        <li>Direction vectors for exploring adjacent cells</li>
                                        <li>Path reconstruction logic to determine the shortest route</li>
                                    </ul>
                                    <pre><code class="language-python">def bfs(maze, start, end):
    queue = collections.deque([start])
    visited = {start: None}
    
    while queue:
        current = queue.popleft()
        
        if current == end:
            break
            
        for dx, dy in [(0,1), (1,0), (0,-1), (-1,0)]:
            next_x, next_y = current[0] + dx, current[1] + dy
            next_pos = (next_x, next_y)
            
            if (0 <= next_x < len(maze) and 
                0 <= next_y < len(maze[0]) and 
                maze[next_x][next_y] != '#' and 
                next_pos not in visited):
                queue.append(next_pos)
                visited[next_pos] = current
                
    # Reconstruct path
    path = []
    current = end
    while current != start:
        path.append(current)
        current = visited[current]
    path.append(start)
    path.reverse()
    
    return path</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header" id="headingThree">
                                <h3 class="mb-0">
                                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        User Interface
                                    </button>
                                </h3>
                            </div>
                            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#implementationAccordion">
                                <div class="card-body">
                                    <p>The game interface was designed to be intuitive and visually engaging:</p>
                                    <ul>
                                        <li>Clear representation of the maze using a grid of cells</li>
                                        <li>Visual differentiation between walls, paths, and characters</li>
                                        <li>Control panel for selecting game modes and maze configurations</li>
                                        <li>Path visualization to display the BFS solution</li>
                                        <li>Animation for Jerry's movement along the found path</li>
                  </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 id="features" class="section-title">Game Features</h2>
                    <div class="card feature-box">
                        <div class="card-body">
                            <h3>Multiple Game Modes</h3>
                            <ul>
                                <li><strong>Manual Mode:</strong> Players can control Jerry's movement using arrow keys or on-screen buttons</li>
                                <li><strong>AI Mode:</strong> Players can watch as the BFS algorithm automatically finds and navigates the shortest path</li>
                                <li><strong>Step Mode:</strong> Shows the BFS algorithm working step-by-step for educational purposes</li>
          </ul>

                            <h3>Maze Customization</h3>
                            <ul>
                                <li>Multiple pre-defined maze layouts with varying complexity</li>
                                <li>Ability to modify maze walls and paths</li>
                                <li>Adjustable starting positions for Tom and Jerry</li>
          </ul>

                            <h3>Educational Components</h3>
                            <ul>
                                <li>Visual representation of the BFS algorithm in action</li>
                                <li>Path highlighting showing the shortest route</li>
                                <li>Step counter to demonstrate path efficiency</li>
                                <li>Optional visualization of the BFS queue and visited nodes</li>
                  </ul>
                        </div>
                    </div>

                    <h2 id="demo" class="section-title">Demo</h2>
                    <div class="project-image-container">
                        <img src="images/maze_animation.gif" alt="Maze Game Demonstration" class="result-pic">
                        <div class="image-caption">BFS Algorithm solving the maze and Jerry following the path</div>
      </div>

                    <h2 id="conclusion" class="section-title">Conclusion</h2>
                    <div class="card feature-box">
                        <div class="card-body">
                            <p>This project successfully demonstrates how graph algorithms like BFS can be applied to solve practical problems such as pathfinding in games. The Tom and Jerry theme adds an engaging wrapper around the technical implementation, making it both entertaining and educational.</p>
                            <p>Through this implementation, I gained valuable experience in:</p>
                            <ul>
                                <li>Algorithm implementation in a practical context</li>
                                <li>Game design and user interface development</li>
                                <li>Data structure usage for efficient problem-solving</li>
                                <li>Visualizing abstract concepts in an accessible way</li>
              </ul>
                            <p>The maze game not only serves as a fun application but also as an educational tool that helps visualize how computers solve pathfinding problems efficiently using graph traversal algorithms.</p>
                        </div>
                    </div>

                    <div class="navigation-section">
                        <div class="row">
                            <div class="col-md-6">
                                <a href="https://henrylam.blog/immersive-ball-shooter" class="nav-card prev-card">
                                    <div class="nav-direction">Previous Project</div>
                                    <div class="nav-title">Immersive Ball Shooter</div>
                                </a>
                            </div>
                            <div class="col-md-6">
                                <a href="https://henrylam.blog/robot-controlled-vehicle" class="nav-card next-card">
                                    <div class="nav-direction">Next Project</div>
                                    <div class="nav-title">Robot-Controlled Vehicle</div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
          </div>

          <hr>
            <h2>My Other Projects:</h2>
        
            <div class="suggested-project">
              <a href="https://henrylam.blog/robot-controlled-vehicle" class="project-link">
                  <div class="row no-gutters">
                    <div class="col-md-3 col-sm-4 col-12 img-col">
                          <img src="images/robot.JPG" alt="Robot Controlled Vehicle" class="project-img">
                      </div>
                    <div class="col-md-9 col-sm-8 col-12 project-details">
                          <h3 class="post-title">Robot-Controlled Vehicle</h3>
                          <p class="post-snippet">A robot vehicle equipped with control circuits and sensors</p>
                      </div>
                  </div>
              </a>
           </div>  
        
            <div class="suggested-project">
            <a href="https://henrylam.blog/wordle-solver" class="project-link">
                    <div class="row no-gutters">
                    <div class="col-md-3 col-sm-4 col-12 img-col">
                        <img src="images/wordle.jpg" alt="Wordle Solver" class="project-img">
                        </div>
                    <div class="col-md-9 col-sm-8 col-12 project-details">
                        <h3 class="post-title">Wordle Solver</h3>
                        <p class="post-snippet">Wordle Solver using greedy best-first searching algorithm</p>
                    </div>
                    </div>
                </a>
            </div>
        
            <div class="suggested-project">
            <a href="https://henrylam.blog/immersive-ball-shooter" class="project-link">
                    <div class="row no-gutters">
                    <div class="col-md-3 col-sm-4 col-12 img-col">
                        <img src="images/immersive_ball_shooter.png" alt="Immersive Ball Shooter" class="project-img">
                        </div>
                    <div class="col-md-9 col-sm-8 col-12 project-details">
                        <h3 class="post-title">Immersive Ball Shooter</h3>
                        <p class="post-snippet">An interactive Unity3D ball shooter game with immersive gameplay</p>
                    </div>
                    </div>
                </a>
            </div>
    </div>
            
    <!-- Back to Top Button -->
    <div id="back-to-top" class="back-to-top">
        <a href="#" class="btn back-to-top-btn" role="button"><i class="icon-arrow-up22"></i></a>
    </div>
    
    <!-- Footer -->
    <div id="fh5co-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <p>&copy; <span style="font-size: 16px;"><a href="http://henrylam.blog">henrylam.blog</a></span><br><span style="font-size: 12px;">Made by Henry Lam</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Include any necessary JavaScript files -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.easypiechart.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false"></script>
    <script src="js/google_map.js"></script>
    <script src="js/main.js"></script>
    
    <!-- Custom Script for UI Enhancements -->
    <script>
        $(document).ready(function() {
            // Smooth scrolling for anchor links (TOC and other internal links)
            $('a[href^="#"][data-toggle!="tab"][data-toggle!="collapse"]').on('click', function(event) {
                var target = $(this.getAttribute('href'));
                if( target.length ) {
                    event.preventDefault();
                    $('html, body').stop().animate({
                        scrollTop: target.offset().top - 90 // Adjusted offset for navbar
                    }, 500);
                }
            });
            
            // Back to top button
            $(window).scroll(function() {
                if ($(this).scrollTop() > 300) {
                    $('#back-to-top').fadeIn();
                } else {
                    $('#back-to-top').fadeOut();
                }
            });
            
            $('#back-to-top').click(function(e) {
                e.preventDefault(); // Prevent hash in URL
                $('html, body').animate({scrollTop: 0}, 800);
                return false;
            });
            
            // TOC Active State on Scroll
            function updateActiveTocLink() {
                var scrollPosition = $(window).scrollTop();
                var offset = 100; // Navbar height + some margin
                var windowHeight = $(window).height();
                var documentHeight = $(document).height();
                var activeSectionFound = false;

                // Remove active class from all links first
                $('#toc .nav-link').removeClass('active');

                // Iterate through sections from bottom to top
                // This ensures that the lowest section visible in the viewport gets activated
                var sections = [];
                $('#toc .nav-link').each(function() {
                    var href = $(this).attr('href');
                    if (href && href.startsWith('#')) {
                        var section = $(href);
                        if (section.length) {
                            sections.push({ link: $(this), element: section });
                        }
                    }
                });

                for (var i = sections.length - 1; i >= 0; i--) {
                    var sectionTop = sections[i].element.offset().top;

                    // Check if the section is within the viewport or if its top is above the scroll position + offset
                    if (sectionTop - offset <= scrollPosition) {
                        sections[i].link.addClass('active');
                        activeSectionFound = true;
                        break; // Found the current section, no need to check further
                    }
                }
                
                // If scrolled to the very bottom, ensure the last TOC item is active
                if (!activeSectionFound && (scrollPosition + windowHeight >= documentHeight - 20)) { 
                    if (sections.length > 0) {
                        $('#toc .nav-link').removeClass('active'); // Clear any previous active
                        sections[sections.length - 1].link.addClass('active');
                    }
                }
            }

            var tocScrollTimeout;
            $(window).on('scroll', function() {
                clearTimeout(tocScrollTimeout);
                tocScrollTimeout = setTimeout(updateActiveTocLink, 50); // Debounce scroll event
            });
            updateActiveTocLink(); // Initial call
        });
    </script>
</body>
</html>
