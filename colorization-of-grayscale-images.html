<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Colorization of Grayscale Images | Henry Lam</title>
        <!-- Include any necessary CSS files -->
        <!-- <link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet"> -->
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato:300" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="css/animate.css">
        <link rel="stylesheet" href="css/icomoon.css">
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
        <link rel="manifest" href="favicon/site.webmanifest">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-K03ESX8LJE"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-K03ESX8LJE');
        </script>
        <style>
            /* Original styles - Reverted from theme system */
        body {
            font-family: 'Lato', sans-serif;
            font-weight: 300;
            font-size: 18px;
            color: #666;
            background-color: #f8f9fa;
            margin: 0;
            overflow-x: hidden;
                line-height: 1.8;
        }

        .custom-toggler.navbar-toggler {
                border-color: #ff9000; 
        }
        .navbar-brand h1 {
                font-family: 'Kaushan Script', cursive; 
            font-size: 26px;
            color: #ffffff;
            margin: 0;
        }
    
        .navbar-nav .nav-item .nav-link {
            font-family: 'Lato', sans-serif;
            color: #ffffff;
            font-size: 18px;
            align-items: center;
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
        }
        
            h1, h2, h3, h4, h5, h6 {
            color: #3a170f;
            font-family: 'Lato', sans-serif;
                margin-bottom: 1rem;
            }
            h1 { font-size: 2.25em; line-height: 1.6; }
            h2 { font-size: 1.7em; line-height: 1.6; }
            h3 { font-size: 1.4em; line-height: 1.6; }
            p { color: #666; font-size: 18px; line-height: 1.8; }

            a {
                color: #ff9000;
                text-decoration: none !important;
            }
            a:hover {
                color: #e08000; /* Darker orange on hover */
                text-decoration: none !important;
            }
            .navbar-custom {
                background-color: #ff9000 !important;
            }
            .toggler-icon {
                background: #ffffff;
            }
            hr { border: none; height: 1px; background-color: #ff9000; margin: 30px 0; }

            .card, .feature-box, .method-card, .implementation-section, .results-container, .project-links, .nav-card, .suggested-project, .toc-nav {
                background-color: #fff;
                box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                border-radius: 10px;
                border: 1px solid #ddd;
            }
            .feature-box h3, .method-icon, .result-number { color: #ff9000; }
            
            .toc-nav { padding: 20px; margin-bottom: 30px; }
            .toc-header { color: #3a170f; border-bottom: 2px solid #ff9000; font-weight: bold; font-size: 1.2em; padding-bottom: 10px; margin-bottom: 15px; }
            .toc-list { padding-left: 0; list-style: none;}
            .toc-list .nav-link { color: #666; padding: 8px 5px; border-left: 3px solid transparent; transition: all 0.3s ease;}
            .toc-list .nav-link:hover, .toc-list .nav-link.active {
                color: #ff9000;
                border-left-color: #ff9000;
                background-color: #f8f9fa;
            }

            .section-title { margin-top: 40px; padding-bottom: 10px; border-bottom: 3px solid #ff9000; display: inline-block;}
            .project-summary { font-size: 1.1em; line-height: 1.8; border-left: 4px solid #ff9000; padding-left: 15px; margin: 20px 0;}
            .image-caption { text-align: center; font-style: italic; color: #888; margin-top: 10px;}
            .lab-text { text-align: center; font-style: italic; color: #888;}

            img.result-pic, img.lab-gif, .project-img {
                border-radius: 10px;
                max-width: 100%;
                height: auto;
                display: block;
                margin-left: auto;
                margin-right: auto;
            }
            
            .project-img {
                width: 120px;
                height: 120px;
                border-radius: 6px;
                overflow: hidden;
                display: block;
                object-fit: cover;
}

.suggested-project {
    margin-top: 5%;
    margin-bottom: 30px;
                background: transparent;
                border: none;
                box-shadow: none;
                max-width: 800px;
                margin-left: 0;
                margin-right: auto;
            }
            
.suggested-project:hover {
    transform: translateY(-5px);
    transition: .5s ease;
            }
            
            .project-details {
                text-align: left;
                padding-left: 15px;
            }
            
            .img-col {
                padding-right: 0 !important;
                display: flex;
                justify-content: flex-end;
            }
            
            .suggested-project .row.no-gutters {
                display: flex;
                align-items: center;
            }
            
            .suggested-project a {
                color: inherit;
                text-decoration: none;
    display: block;
            }
            
            .suggested-project h3 {
                margin-top: 0;
                margin-bottom: 8px;
                color: #3a170f;
                font-weight: normal;
            }
            
            .suggested-project p {
                margin-bottom: 0;
                color: #666;
                font-size: 16px;
            }

            /* Navigation section */
            .navigation-section { margin-top: 60px; margin-bottom: 40px; }
            .nav-card {
                background: transparent;
                box-shadow: none;
                border: none;
                display: block;
                padding: 15px 0;
                margin: 10px 0;
                color: #3a170f;
            }
            .nav-card:hover {
                color: #ff9000;
                transform: translateY(-5px);
                box-shadow: none;
                text-decoration: none;
            }
            .prev-card { text-align: left; }
            .next-card { text-align: right; }
            .nav-direction { font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; color: #888; }
            .nav-title { font-size: 1.2em; font-weight: bold; }

            .back-to-top { position: fixed; bottom: 30px; right: 30px; display: none; z-index: 99; }
            .back-to-top-btn { 
                width: 50px; 
                height: 50px; 
                border-radius: 50%; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                box-shadow: 0 3px 10px rgba(0,0,0,0.2); 
                transition: all 0.3s ease;
                background-color: #ff9000;
                color: #ffffff;
            }
            .back-to-top-btn:hover { 
                transform: translateY(-3px); 
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                background-color: #e08000;
                color: #ffffff;
            }

            /* Main container spacing */
            .main-container {
                padding-top: 80px;
            }
            
            /* Responsive adjustments */
            @media (min-width: 992px) {
                .col-lg-9 {
                    padding-top: 30px;
                }
            }
            
            @media (max-width: 991px) {
                .toc-nav {
                    display: none;
                }
                .col-lg-9 {
                    flex: 0 0 100%;
                    max-width: 100%;
                }
            }
            
            @media (max-width: 767px) {
                .main-container {
                    padding-left: 15px;
                    padding-right: 15px;
                }
                
                .nav-card {
                    text-align: center;
                }
                
                .project-img {
                    width: 100px;
                    height: 100px;
                }
  }
</style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-sm navbar-custom navbar-light fixed-top" style="background-color: #ff9000;">
<div class="container">
    <a class="navbar-brand" href="/"><h1>Henry Lam</h1></a>

    <!-- Toggle button for smaller devices -->
    <button class="navbar-toggler custom-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="toggler-icon top-bar"></span>
        <span class="toggler-icon middle-bar"></span>
        <span class="toggler-icon bottom-bar"></span>
    </button>

    <!-- Navbar links -->
    <div class="collapse navbar-collapse" id="navbar">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a id="about-nav" class="nav-link theme2" href="https://henrylam.blog/#about">About Me</a>
            </li>
            <li class="nav-item">
                <a id="resume-nav" class="nav-link theme2" href="https://henrylam.blog/#resume">Resume</a>
            </li>
            <li class="nav-item">
                <a id="projects-nav" class="nav-link theme2" href="https://henrylam.blog/#projects">Projects</a>
            </li>
        </ul>
    </div>
</div>
</nav>
        
        <!-- Content specific to the project -->
    <div class="main-container">
            <div class="row">
                <!-- Sticky Table of Contents -->
                <div class="col-lg-3 d-none d-lg-block">
                    <nav id="toc" class="sticky-top toc-nav" style="top: 100px;">
                        <div class="toc-header">Contents</div>
                        <ul class="nav flex-column toc-list">
                            <li class="nav-item"><a class="nav-link" href="#intro">Introduction</a></li>
                            <li class="nav-item"><a class="nav-link" href="#methods">Methods</a></li>
                            <li class="nav-item"><a class="nav-link" href="#implementations">Implementations</a></li>
                            <li class="nav-item"><a class="nav-link" href="#test-images">Test Images</a></li>
                            <li class="nav-item"><a class="nav-link" href="#evaluation">Evaluation</a></li>
                            <li class="nav-item"><a class="nav-link" href="#conclusion">Conclusion</a></li>
                        </ul>
                    </nav>
                </div>

                <!-- Main Content -->
                <div class="col-lg-9">
                    <div id="main-text" style="max-width: 850px; margin: 0 auto;">
                        <!-- Project content -->
                        <h1 id="intro" class="section-title">Colorization of Grayscale Images</h1>

                        <div class="project-summary">
                            <p>A comprehensive exploration of image colorization techniques, comparing traditional methods with modern deep learning approaches to breathe life into black and white photographs.</p>
                        </div>

                        <div class="card feature-box">
                            <div class="card-body">
                                <p>In the realm of image processing and computer vision, colorization of grayscale images stands as a fascinating challenge that combines technical expertise with artistic sensibility. This project explores various approaches to this problem, aiming to breathe life and vibrancy into monochromatic images.</p>
                                <p>Colorization, particularly of historical black and white photographs, not only enhances visual appeal but also improves the viewer's engagement and comprehension of the image's context and era. By exploring both traditional and modern deep learning-based methodologies, this research delves into the art and science of adding color to the colorless world of grayscale imagery.</p>
                            </div>
                        </div>

                        <h2 id="methods" class="section-title">Methods</h2>
                        <p>The colorization of grayscale images can be approached through several distinct methodologies, each with its own strengths and limitations.</p>
                        
                        <div class="card method-card mb-4">
                            <div class="card-header">
                                <h3><i class="icon-pencil method-icon"></i> Manual/Semi-automatic Method</h3>
                            </div>
                            <div class="card-body">
                                <p>This approach involves human intervention and manual selection of colors for various regions of the image. While labor-intensive, it offers precise control over the colorization process and can yield historically accurate results. Modern tools streamline this process with scribble-based interfaces where users provide color hints that are then propagated throughout similar regions.</p>
                            </div>
                        </div>
                        
                        <div class="card method-card mb-4">
                            <div class="card-header">
                                <h3><i class="icon-cogs method-icon"></i> Example-based Method</h3>
                            </div>
                            <div class="card-body">
                                <p>Example-based colorization leverages a reference color image with similar content to transfer its color characteristics to the target grayscale image. This method excels when appropriate reference images are available, though finding suitable matches can be challenging.</p>
                            </div>
                        </div>
                        
                        <div class="card method-card mb-4">
                            <div class="card-header">
                                <h3><i class="icon-embed2 method-icon"></i> Learning-based Method</h3>
                            </div>
                            <div class="card-body">
                                <p>Deep learning has revolutionized image colorization, utilizing convolutional neural networks (CNNs) to predict color values based on patterns learned from vast datasets. These approaches range from supervised learning with paired grayscale-color images to sophisticated generative adversarial networks (GANs) that produce remarkably realistic results.</p>
                            </div>
                        </div>

                        <h2 id="implementations" class="section-title">Implementations</h2>
                        <p>For this comparative analysis, we implemented three distinct colorization methods to evaluate their strengths, limitations, and appropriate use cases:</p>
                        
                        <div class="accordion mt-4" id="implementationAccordion">
                            <div class="card">
                                <div class="card-header" id="headingOne">
                                    <h3 class="mb-0">
                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                            Traditional Colorization
                                        </button>
                                    </h3>
                                </div>
                                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#implementationAccordion">
                                    <div class="card-body">
                                        <p>Our manual approach utilized advanced color transfer algorithms that require minimal user input. This method accepts user-provided color scribbles and intelligently propagates them throughout the image based on intensity similarities. The algorithm optimizes for color consistency across similar regions while respecting luminance boundaries.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="headingTwo">
                                    <h3 class="mb-0">
                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                            CNN-based Colorization
                                        </button>
                                    </h3>
                                </div>
                                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#implementationAccordion">
                                    <div class="card-body">
                                        <p>We implemented a deep learning approach using a U-Net architecture, which preserves spatial details through skip connections. The network was trained on a diverse dataset of color images, learning to predict chrominance values from luminance input in the LAB color space. This fully automatic method requires no user guidance and can produce plausible colorization for common scenes and objects.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="headingThree">
                                    <h3 class="mb-0">
                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                            Hybrid Method
                                        </button>
                                    </h3>
                                </div>
                                <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#implementationAccordion">
                                    <div class="card-body">
                                        <p>Our hybrid approach combines the strengths of both previous methods. It utilizes a pretrained CNN to generate an initial colorization, which users can then refine with targeted color hints. This allows for automatic colorization with the option for human artistic input where precise color control is desired. The system intelligently blends the automatic prediction with user guidance for seamless results.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h2 id="test-images" class="section-title">Test Images</h2>
                        <p>We evaluated our colorization methods on a diverse set of test images, spanning various categories and complexity levels to ensure comprehensive analysis.</p>
                        
                        <div class="project-image-container">
                            <img src="images/colorization/test_images.jpg" alt="Sample test images" class="result-pic">
                            <div class="image-caption">Sample test images including portraits, landscapes, and complex scenes</div>
                        </div>

                        <h2 id="evaluation" class="section-title">Evaluation</h2>
                        
                        <div class="card feature-box">
                            <div class="card-body">
                                <p>We conducted both quantitative and qualitative evaluations of our colorization methods. Quantitatively, we employed metrics such as PSNR (Peak Signal-to-Noise Ratio), SSIM (Structural Similarity Index), and color histogram comparisons against ground truth color images. Qualitatively, we conducted user studies to assess the perceptual quality and realism of the colorized results.</p>
                            </div>
                        </div>
                        
                        <div class="project-image-container">
                            <img src="images/Automatic-Colorization.png" alt="Comparison of colorization results" class="result-pic">
                            <div class="image-caption">Comparison of colorization results across different methods. From left to right: Original grayscale, Traditional method, CNN-based method, Hybrid method, Ground truth</div>
                        </div>
                        
                        <h3>Quantitative Analysis</h3>
                        <div class="results-container">
                            <table class="table">
                                <thead class="thead-light">
                                    <tr>
                                        <th>Method</th>
                                        <th>PSNR (dB)</th>
                                        <th>SSIM</th>
                                        <th>Processing Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                                        <td>Traditional</td>
                                        <td>23.45</td>
                                        <td>0.82</td>
                                        <td>2-5 minutes</td>
                    </tr>
                    <tr>
                                        <td>CNN-based</td>
                                        <td>25.67</td>
                                        <td>0.85</td>
                                        <td>&lt;2 seconds</td>
                    </tr>
                    <tr>
                                        <td>Hybrid</td>
                                        <td>27.32</td>
                                        <td>0.88</td>
                                        <td>10-30 seconds</td>
                    </tr>
                </tbody>
            </table>
        </div>
                        
                        <h3>Qualitative Assessment</h3>
                        <div class="card feature-box">
                            <div class="card-body">
                                <ul>
                                    <li><strong>Traditional Method:</strong> Produced historically accurate colors when guided by expert users, but required significant time investment and artistic skill.</li>
                                    <li><strong>CNN-based Method:</strong> Generated plausible colorizations automatically for common scenes, but occasionally produced muted colors or artifacts in unusual contexts.</li>
                                    <li><strong>Hybrid Method:</strong> Achieved the best overall results by combining automatic colorization with targeted human guidance, offering a balance of efficiency and quality.</li>
        </ul>
                            </div>
                        </div>

                        <h2 id="conclusion" class="section-title">Conclusion</h2>
                        <div class="card feature-box">
                            <div class="card-body">
                                <p>Our comparative analysis reveals that each colorization approach has distinct strengths and suitable use cases. The traditional method provides precise control for historically significant images where accuracy is paramount. The CNN-based approach offers rapid, fully automatic colorization ideal for batch processing of large image collections. The hybrid method presents the most versatile solution, balancing automation with the option for human artistic input.</p>
                                <p>While no single method emerges as universally superior, the hybrid approach demonstrates the most promising direction for future development, leveraging both computational efficiency and human aesthetic judgment. As deep learning techniques continue to evolve, we anticipate even more seamless integration of automatic algorithms with intuitive user guidance, making colorization increasingly accessible and effective for both casual users and professional applications.</p>
                            </div>
                        </div>

                        <div class="navigation-section">
                            <div class="row">
                                <div class="col-md-6">
                                    <a href="https://henrylam.blog/carbon-credit-tokenization" class="nav-card prev-card">
                                        <div class="nav-direction">Previous Project</div>
                                        <div class="nav-title">Carbon Credit Tokenization</div>
                                    </a>
                                </div>
                                <div class="col-md-6">
                                    <a href="https://henrylam.blog/distinguishing-people-with-masks" class="nav-card next-card">
                                        <div class="nav-direction">Next Project</div>
                                        <div class="nav-title">Distinguishing People with Masks</div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

        <hr>
            <h2>My Other Projects:</h2>
            
            <div class="suggested-project">
                <a href="https://henrylam.blog/personalized-clothing-style-fashion-assistant" class="project-link">
                    <div class="row no-gutters">
                        <div class="col-md-3 col-sm-4 col-12 img-col">
                            <img src="images/personalized-clothing-style-fashion-assistant.png" alt="Personalized Clothing Style Fashion Assistant" class="project-img">
                        </div>
                        <div class="col-md-9 col-sm-8 col-12 project-details">
                            <h3 class="post-title">Personalized Clothing Style Fashion Assistant</h3>
                            <p class="post-snippet">An AI-powered fashion assistant that recommends personalized clothing styles</p>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="suggested-project">
                <a href="https://henrylam.blog/carbon-credit-tokenization" class="project-link">
                    <div class="row no-gutters">
                        <div class="col-md-3 col-sm-4 col-12 img-col">
                            <img src="images/cc.jpg" alt="Carbon Credit Tokenization" class="project-img">
                        </div>
                        <div class="col-md-9 col-sm-8 col-12 project-details">
                            <h3 class="post-title">Carbon Credit Tokenization</h3>
                            <p class="post-snippet">Research on applying blockchain technology to carbon credit markets</p>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="suggested-project">
                <a href="https://henrylam.blog/distinguishing-people-with-masks" class="project-link">
                    <div class="row no-gutters">
                        <div class="col-md-3 col-sm-4 col-12 img-col">
                            <img src="images/masks.png" alt="Distinguishing individuals with masks" class="project-img">
                        </div>
                        <div class="col-md-9 col-sm-8 col-12 project-details">
                            <h3 class="post-title">Distinguishing individuals with masks</h3>
                            <p class="post-snippet">A machine learning project to differentiate people wearing masks</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- Back to Top Button -->
        <div id="back-to-top" class="back-to-top">
            <a href="#" class="btn back-to-top-btn" role="button"><i class="icon-arrow-up22"></i></a>
    </div>
        
        <!-- Footer -->
    <div id="fh5co-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-12 text-center">
					<p>&copy; <span style="font-size: 16px;"><a href="http://henrylam.blog">henrylam.blog</a></span><br><span style="font-size: 12px;">Made by Henry Lam</span></p>
				</div>
			</div>
		</div>
	</div>

    <!-- Include any necessary JavaScript files -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.easypiechart.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&amp;sensor=false"></script>
    <script src="js/google_map.js"></script>
    <script src="js/main.js"></script>
        
        <!-- Custom Script for UI Enhancements -->
        <script>
            $(document).ready(function() {
                // Smooth scrolling for anchor links (TOC and other internal links)
                $('a[href^="#"][data-toggle!="tab"][data-toggle!="collapse"]').on('click', function(event) {
                    var target = $(this.getAttribute('href'));
                    if( target.length ) {
                        event.preventDefault();
                        $('html, body').stop().animate({
                            scrollTop: target.offset().top - 90 // Adjusted offset for navbar
                        }, 500);
                    }
                });
                
                // Back to top button
                $(window).scroll(function() {
                    if ($(this).scrollTop() > 300) {
                        $('#back-to-top').fadeIn();
                    } else {
                        $('#back-to-top').fadeOut();
                    }
                });
                
                $('#back-to-top').click(function(e) {
                    e.preventDefault(); // Prevent hash in URL
                    $('html, body').animate({scrollTop: 0}, 800);
                    return false;
                });
                
                // TOC Active State on Scroll
                function updateActiveTocLink() {
                    var scrollPosition = $(window).scrollTop();
                    var offset = 100; // Navbar height + some margin
                    var windowHeight = $(window).height();
                    var documentHeight = $(document).height();
                    var activeSectionFound = false;

                    // Remove active class from all links first
                    $('#toc .nav-link').removeClass('active');

                    // Iterate through sections from bottom to top
                    // This ensures that the lowest section visible in the viewport gets activated
                    var sections = [];
                    $('#toc .nav-link').each(function() {
                        var href = $(this).attr('href');
                        if (href && href.startsWith('#')) {
                            var section = $(href);
                            if (section.length) {
                                sections.push({ link: $(this), element: section });
                            }
                        }
                    });

                    for (var i = sections.length - 1; i >= 0; i--) {
                        var sectionTop = sections[i].element.offset().top;

                        // Check if the section is within the viewport or if its top is above the scroll position + offset
                        if (sectionTop - offset <= scrollPosition) {
                            sections[i].link.addClass('active');
                            activeSectionFound = true;
                            break; // Found the current section, no need to check further
                        }
                    }
                    
                    // If scrolled to the very bottom, ensure the last TOC item is active
                    if (!activeSectionFound && (scrollPosition + windowHeight >= documentHeight - 20)) { 
                        if (sections.length > 0) {
                            $('#toc .nav-link').removeClass('active'); // Clear any previous active
                            sections[sections.length - 1].link.addClass('active');
                        }
                    }
                }

                var tocScrollTimeout;
                $(window).on('scroll', function() {
                    clearTimeout(tocScrollTimeout);
                    tocScrollTimeout = setTimeout(updateActiveTocLink, 50); // Debounce scroll event
                });
                updateActiveTocLink(); // Initial call
            });
        </script>
</body>
</html>
